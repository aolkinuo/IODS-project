q()
# Regression and model validation
#Valitettavasti en saanut kuvia, muuttujien välisiä
#hajontakuvia ja korrelaatioita sekä diagnostisia
#kuvia, siirrettyä Rstudiosta chapter.Rmd-tiedostoon
#ja sitä kautta päiväkirjaan. Kuvien tulkinta
#on kuitenkin mukana päiväkirjassa, toivottavasti
#vertaisarvioija jaksaa lukea kuvien tulkinnan vaikka
#kuvat puuttuvat. Pahoittelen myös että päiväkirja
#näyttää kummalliselta. Fontti on liian suuri.
learning2014=read.table("data/learning2014.txt", sep = ",", header = TRUE)
str(learning2014)
dim(learning2014)
#Aineistossa on 166 havaintoyksikköä ja seitsemän muuttujaa.
#Muuttujat Age, Attitude, Points ovat numeerisia
#kokonaislukumuuttujia ja ne kertovat henkilön iän, asenteen
#tilastotiedettä kohtaan ja koepisteet. Ikä on laskettu
#syntymävuoden avulla. Muuttujat deep, stra ja surf ovat
#numeerisia muuttujia. Ne kertovat henkilön vastaukset
#syvällisiin, strategisiin ja pinnallisiin kysymyksiin.
#gender on luokiteltu muuttuja ja sen arvo 1 kuvaa naista
#ja arvo 2 miestä.
summary(learning2014)
# gender       Age           Attitude          deep
# F:110   Min.   :17.00   Min.   :14.00   Min.   :1.583
# M: 56   1st Qu.:21.00   1st Qu.:26.00   1st Qu.:3.333
#         Median :22.00   Median :32.00   Median :3.667
#         Mean   :25.51   Mean   :31.43   Mean   :3.680
#         3rd Qu.:27.00   3rd Qu.:37.00   3rd Qu.:4.083
#         Max.   :55.00   Max.   :50.00   Max.   :4.917
#      stra            surf           Points
# Min.   :1.250   Min.   :1.583   Min.   : 7.00
# 1st Qu.:2.625   1st Qu.:2.417   1st Qu.:19.00
# Median :3.188   Median :2.833   Median :23.00
# Mean   :3.121   Mean   :2.787   Mean   :22.72
# 3rd Qu.:3.625   3rd Qu.:3.167   3rd Qu.:27.75
# Max.   :5.000   Max.   :4.333   Max.   :33.00
#Aineiston yhteenvedosta, joka on tämän tekstin yläpuolella
#nähdään muuttujien Age, Attitude, deep, stra, surf ja Points
#minimit, maksimit, ensimmäinen ja kolmas kvantiili, mediaani
#ja keskiarvo. Muuttujasta gender nähdään sen kahden arvon
#frekvenssit.
library(ggplot2)
library(GGally)
pairs(learning2014[-1], col = learning2014$gender)
p=ggpairs(learning2014, mapping = aes(col = gender, alpha = 0.3), lower = list(combo = wrap("facethist", bins = 20)))
p
#Kuvasta nähdään että muuttujat Attitude, deep ja stra ovat
#jakautuneet lähes normaalisti naisten ja miesten joukossa.
#Myös surf on naisten osalta jakautunut lähes normaalisti.
#Age on vinoutunut, skewed, oikealle ja myös surf on
#vinoutunut oikealle miesten osalta. Points-muuttujan jakauma
#on vinoutunut vasemmalle. Korrelaatiokertoimista nähdään
#että muuttujat Attitude ja Age, deep ja
#Age, deep ja Attitude, stra ja Attitude, Points ja Attitude,
#stra ja deep, Points ja deep korreloivat suhteellisen paljon
#naisten joukossa. Muuttujat Attitude ja Age, deep ja Age,
#stra ja Age, surf ja Attitude, Points ja Attitude, surf ja deep,
#Points ja deep korreloivat suhteellisen paljon miesten
#joukossa. Suuren korrelaatiokertoimen tulkinta on esimerkiksi
#muuttujien Attitude ja Age kohdalla se että asenteen
#tilastotiedettä kohtaan ja iän välillä on riippuvuutta. Jos
#korrelaatiokerroin olisi yksi, toisen muuttujan arvon voisi laskea #tarkasti, lineaarisesti toisen arvosta.
malli1=lm(Points~Age+Attitude+deep, data=learning2014)
summary(malli1)
#Kun estimoidaan pienimmän neliösumman menetelmällä malli
#jossa ikä, asenne tilastotiedettä kohtaan ja syvälliset
#kysymykset selittävät koepisteitä, saadaan tulokseksi
#tulostus joka on alla.
#Residuals:
#    Min      1Q  Median      3Q     Max
#-17.206  -3.430   0.204   3.979  10.950
#Coefficients:
#           Estimate Std. Error t value Pr(>|t|)
#(Intercept) 15.60773    3.38966   4.605 8.32e-06 ***
#Age         -0.07716    0.05322  -1.450    0.149
#Attitude     0.35941    0.05696   6.310 2.56e-09 ***
#deep        -0.60275    0.75031  -0.803    0.423
#---
#Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
#Residual standard error: 5.307 on 162 degrees of freedom
#Multiple R-squared:  0.2043,	Adjusted R-squared:  0.1896
#F-statistic: 13.87 on 3 and 162 DF,  p-value: 4.305e-08
#Ensimmäisessä sarakkeessa jossa on numeroita näkyy selittäviin
#muuttujiin liittyvien parametrien eli parametrivektorin arvot. #Niistä nähdään että kun ikä kasvaa yhdellä, koepisteet laskevat #noin -0.08 verran. Kun asenne tilastotiedettä kohtaan nousee #yhdellä, koepisteet kasvavat noin 0.36 verran. Kun taas
#syvälliset kysymykset nousevat yhdellä, koepisteet laskevat
#0.6 verran. Kun ikä, asenne ja syvälliset kysymykset ovat
#nolla, koepisteet saavan vakiotermin mukaisen arvon eli noin #15.61.
#Tähdet kuvassa kertovat selittävien muuttujien tilastollisesta
#merkitsevyydestä. Tähtien taustalla on tilastollinen testi
#jossa testataan sitä voidaanko nollahypoteesi siitä että
#selittävään muuttujaan liittyvä parametri on nolla hylätä.
#Nollahypoteesit että vakiotermin ja asennemuuttujan parametrit
#ovat nolla voidaan hylätä 0.1 prosentin merkitsevyystasolla eli
#asennemuuttujan ja vakiotermin parametrit eli vaikutukset #selitettävään koepistemuuttujaan ovat merkitseviä.Nollahypoteeseja
#siitä että asenne- ja syvälliset kysymykset-muuttujien parametrit
#ovat nolla, ei voida hylätä. Asenne- ja syvälliset kysymykset
#-muuttujien vaikutukset koepistemuuttujaan eivät siis ole
#merkitseviä. Poistetaan muuttujien vaikutusten huonon
#merkitsevyyden puolesta asenne- ja syvälliset #kysymykset-muuttujat mallista ja estimoidaan pienimmän neliösumman #menetelmällä malli jossa on yksi selittävä muuttuja. Se on
#asenne tilastotiedettä kohtaan.
malli2=lm(Points~Attitude, data=learning2014)
summary(malli2)
#Residuals:
#     Min       1Q   Median       3Q      Max
#-16.9763  -3.2119   0.4339   4.1534  10.6645
#Coefficients:
#            Estimate Std. Error t value Pr(>|t|)
#(Intercept) 11.63715    1.83035   6.358 1.95e-09 ***
#Attitude     0.35255    0.05674   6.214 4.12e-09 ***
#---
#Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
#
#Residual standard error: 5.32 on 164 degrees of freedom
#Multiple R-squared:  0.1906,	Adjusted R-squared:  0.1856
#F-statistic: 38.61 on 1 and 164 DF,  p-value: 4.119e-09
#Tulostuksesta nähdään että asennemuuttujan parametrin arvo on
#noin 0.35. Se tarkoittaa että kun asennemuuttuja kasvaa
#yhdellä, koepisteet kasvavat noin 0.35 verran. Asennemuuttujaan ja #vakiotermiin liittyvät parametrit ovat tilastollisesti merkitseviä
#0.1 prosentin merkitsevyystasoilla.
#Multiple R-squared ja Adjusted R-squared ovat mallin
#selitysasteita. Selitysaste kertoo sen kuinka paljon malli, eli
#selittävät muuttujat jotka on mallinnettu käyttämällä
#lineaarista regressiota, selittää selitettävän muuttujan #vaihtelusta. Yläpuolella olevan mallin selitysaste kertoo siis sen #että asenteen tilastotiedettä kohtaan ja vakiotermin
#vaihtelut selittävät noin 19 prosenttia koepisteiden vaihtelusta. #Selitysaste kertoo tavallaan mallin suorituskyvystä ja se saa #arvon nollan ja yhden välillä.
#Adjusted R-squared saa aina pienemmän arvon kuin Multiple
#R-squared sillä siinä huomioidaan mallin monimutkaisuus
#eli muuttujien määrä. Adjusted R-squared on tarkempi mallin #suorituskyvyn mittari kuin Multiple R-squared. Uuden
#selittävän muuttujan lisääminen malliin kasvattaa
#todennäköisesti Multiple R-squaredia ja pienentää
#Adjusted R-squaredia.
par(mfrow = c(2,2))
plot(malli2, which = c(1,2,5))
#On piirretty kolme kuvaa, kuva jossa on mallin kaksi sovite ja #residuaalit, QQ-plot-kuva jossa on teoreettiset kvantiilit ja
#standardoidut residuaalit ja kuva jossa on vipuvoima ja
#standardoidut residuaalit.
#Ensimmäisestä kuvasta eli
#kuvasta jossa on sovite x-akselilla ja residuaalit
#y-akselilla voidaan tutkia sitä onko virheillä vakio varianssi.
#Koska havainnot ovat jakautuneet suhteellisen tasaisesti
#nollasuoran ympärille eivätkä muodosta jotakin muotoa
#tai mallia, voidaan sanoa että virhetermin
#varianssi on vakio eikä virheiden suuruus riipu selittävistä
#muuttujista. Virheiden vakio varianssi on yksi oletus
#joka usein tehdään kun estimoidaan lineaarinen regressiomalli.
#Se näyttäisi mallin kaksi tapauksessa olevan voimassa.
#QQ-plot-kuvasta eli kuvasta jossa on teoreettiset kvantiilit
#x-akselilla ja standardoidut residuaalit y-akselilla voidaan
#tehdä päätelmiä virheiden normaalisuudesta. Koska havainnot
#ovat QQ-plot-kuvassa suoran päällä, virhetermin voidaan
#sanoa noudattavan suurin piirtein normaalijakaumaa. Niin
#usein halutaan olettaa ja nyt mallin kaksi tapauksessa voidaan #sanoa että oletus että virheet ovat normaalisti jakaantuneet #voidaan pitää voimassa.
#Kolmannesta kuvasta, jossa on vipuvoima eli Cookin etäisyys #x-akselilla ja standardoidut residuaalit y-akselilla voidaan #päätellä vipuvoiman suuruus. Vipuvoima mittaa sitä kuinka paljon yhdellä havainnolla on vaikutusta malliin. Hajontakuva jossa on #residuaalit ja vipuvoima voi auttaa tunnistamaan ne havainnot #joilla on poikkeuksellisen paljon vaikutusta malliin. Kuvasta
#nähdään että havainto joka saa suurimman vipuvoiman tai Cookin
#etäisyyden arvon saa suunnilleen arvon 0.05. Luku on sen verran
#pieni että vipuvoiman mallissa kaksi voidaan sanoa olevan
#tavallista tai pientä.
#Muita lineaarisen regressiomallin oletuksia ovat virheiden
#normaalisuuden ja vakion varianssin lisäksi oletukset että virheet #eivät korreloi eivätkä riipu selittävistä muuttujista.
setwd("C:/Users/Anna-Liina/Documents/IODS-project")
learning2014=read.table("data/learning2014.txt", sep = ",", header = TRUE)
str(learning2014)
dim(learning2014)
#Aineistossa on 166 havaintoyksikköä ja seitsemän muuttujaa.
#Muuttujat Age, Attitude, Points ovat numeerisia
#kokonaislukumuuttujia ja ne kertovat henkilön iän, asenteen
#tilastotiedettä kohtaan ja koepisteet. Ikä on laskettu
#syntymävuoden avulla. Muuttujat deep, stra ja surf ovat
#numeerisia muuttujia. Ne kertovat henkilön vastaukset
#syvällisiin, strategisiin ja pinnallisiin kysymyksiin.
#gender on luokiteltu muuttuja ja sen arvo 1 kuvaa naista
#ja arvo 2 miestä.
summary(learning2014)
# gender       Age           Attitude          deep
# F:110   Min.   :17.00   Min.   :14.00   Min.   :1.583
# M: 56   1st Qu.:21.00   1st Qu.:26.00   1st Qu.:3.333
#         Median :22.00   Median :32.00   Median :3.667
#         Mean   :25.51   Mean   :31.43   Mean   :3.680
#         3rd Qu.:27.00   3rd Qu.:37.00   3rd Qu.:4.083
#         Max.   :55.00   Max.   :50.00   Max.   :4.917
#      stra            surf           Points
# Min.   :1.250   Min.   :1.583   Min.   : 7.00
# 1st Qu.:2.625   1st Qu.:2.417   1st Qu.:19.00
# Median :3.188   Median :2.833   Median :23.00
# Mean   :3.121   Mean   :2.787   Mean   :22.72
# 3rd Qu.:3.625   3rd Qu.:3.167   3rd Qu.:27.75
# Max.   :5.000   Max.   :4.333   Max.   :33.00
#Aineiston yhteenvedosta, joka on tämän tekstin yläpuolella
#nähdään muuttujien Age, Attitude, deep, stra, surf ja Points
#minimit, maksimit, ensimmäinen ja kolmas kvantiili, mediaani
#ja keskiarvo. Muuttujasta gender nähdään sen kahden arvon
#frekvenssit.
library(ggplot2)
library(GGally)
pairs(learning2014[-1], col = learning2014$gender)
p=ggpairs(learning2014, mapping = aes(col = gender, alpha = 0.3), lower = list(combo = wrap("facethist", bins = 20)))
p
#Kuvasta nähdään että muuttujat Attitude, deep ja stra ovat
#jakautuneet lähes normaalisti naisten ja miesten joukossa.
#Myös surf on naisten osalta jakautunut lähes normaalisti.
#Age on vinoutunut, skewed, oikealle ja myös surf on
#vinoutunut oikealle miesten osalta. Points-muuttujan jakauma
#on vinoutunut vasemmalle. Korrelaatiokertoimista nähdään
#että muuttujat Attitude ja Age, deep ja
#Age, deep ja Attitude, stra ja Attitude, Points ja Attitude,
#stra ja deep, Points ja deep korreloivat suhteellisen paljon
#naisten joukossa. Muuttujat Attitude ja Age, deep ja Age,
#stra ja Age, surf ja Attitude, Points ja Attitude, surf ja deep,
#Points ja deep korreloivat suhteellisen paljon miesten
#joukossa. Suuren korrelaatiokertoimen tulkinta on esimerkiksi
#muuttujien Attitude ja Age kohdalla se että asenteen
#tilastotiedettä kohtaan ja iän välillä on riippuvuutta. Jos
#korrelaatiokerroin olisi yksi, toisen muuttujan arvon voisi laskea #tarkasti, lineaarisesti toisen arvosta.
malli1=lm(Points~Age+Attitude+deep, data=learning2014)
summary(malli1)
#Kun estimoidaan pienimmän neliösumman menetelmällä malli
#jossa ikä, asenne tilastotiedettä kohtaan ja syvälliset
#kysymykset selittävät koepisteitä, saadaan tulokseksi
#tulostus joka on alla.
#Residuals:
#    Min      1Q  Median      3Q     Max
#-17.206  -3.430   0.204   3.979  10.950
#Coefficients:
#           Estimate Std. Error t value Pr(>|t|)
#(Intercept) 15.60773    3.38966   4.605 8.32e-06 ***
#Age         -0.07716    0.05322  -1.450    0.149
#Attitude     0.35941    0.05696   6.310 2.56e-09 ***
#deep        -0.60275    0.75031  -0.803    0.423
#---
#Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
#Residual standard error: 5.307 on 162 degrees of freedom
#Multiple R-squared:  0.2043,	Adjusted R-squared:  0.1896
#F-statistic: 13.87 on 3 and 162 DF,  p-value: 4.305e-08
#Ensimmäisessä sarakkeessa jossa on numeroita näkyy selittäviin
#muuttujiin liittyvien parametrien eli parametrivektorin arvot. #Niistä nähdään että kun ikä kasvaa yhdellä, koepisteet laskevat #noin -0.08 verran. Kun asenne tilastotiedettä kohtaan nousee #yhdellä, koepisteet kasvavat noin 0.36 verran. Kun taas
#syvälliset kysymykset nousevat yhdellä, koepisteet laskevat
#0.6 verran. Kun ikä, asenne ja syvälliset kysymykset ovat
#nolla, koepisteet saavan vakiotermin mukaisen arvon eli noin #15.61.
#Tähdet kuvassa kertovat selittävien muuttujien tilastollisesta
#merkitsevyydestä. Tähtien taustalla on tilastollinen testi
#jossa testataan sitä voidaanko nollahypoteesi siitä että
#selittävään muuttujaan liittyvä parametri on nolla hylätä.
#Nollahypoteesit että vakiotermin ja asennemuuttujan parametrit
#ovat nolla voidaan hylätä 0.1 prosentin merkitsevyystasolla eli
#asennemuuttujan ja vakiotermin parametrit eli vaikutukset #selitettävään koepistemuuttujaan ovat merkitseviä.Nollahypoteeseja
#siitä että asenne- ja syvälliset kysymykset-muuttujien parametrit
#ovat nolla, ei voida hylätä. Asenne- ja syvälliset kysymykset
#-muuttujien vaikutukset koepistemuuttujaan eivät siis ole
#merkitseviä. Poistetaan muuttujien vaikutusten huonon
#merkitsevyyden puolesta asenne- ja syvälliset #kysymykset-muuttujat mallista ja estimoidaan pienimmän neliösumman #menetelmällä malli jossa on yksi selittävä muuttuja. Se on
#asenne tilastotiedettä kohtaan.
malli2=lm(Points~Attitude, data=learning2014)
summary(malli2)
#Residuals:
#     Min       1Q   Median       3Q      Max
#-16.9763  -3.2119   0.4339   4.1534  10.6645
#Coefficients:
#            Estimate Std. Error t value Pr(>|t|)
#(Intercept) 11.63715    1.83035   6.358 1.95e-09 ***
#Attitude     0.35255    0.05674   6.214 4.12e-09 ***
#---
#Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
#
#Residual standard error: 5.32 on 164 degrees of freedom
#Multiple R-squared:  0.1906,	Adjusted R-squared:  0.1856
#F-statistic: 38.61 on 1 and 164 DF,  p-value: 4.119e-09
#Tulostuksesta nähdään että asennemuuttujan parametrin arvo on
#noin 0.35. Se tarkoittaa että kun asennemuuttuja kasvaa
#yhdellä, koepisteet kasvavat noin 0.35 verran. Asennemuuttujaan ja #vakiotermiin liittyvät parametrit ovat tilastollisesti merkitseviä
#0.1 prosentin merkitsevyystasoilla.
#Multiple R-squared ja Adjusted R-squared ovat mallin
#selitysasteita. Selitysaste kertoo sen kuinka paljon malli, eli
#selittävät muuttujat jotka on mallinnettu käyttämällä
#lineaarista regressiota, selittää selitettävän muuttujan #vaihtelusta. Yläpuolella olevan mallin selitysaste kertoo siis sen #että asenteen tilastotiedettä kohtaan ja vakiotermin
#vaihtelut selittävät noin 19 prosenttia koepisteiden vaihtelusta. #Selitysaste kertoo tavallaan mallin suorituskyvystä ja se saa #arvon nollan ja yhden välillä.
#Adjusted R-squared saa aina pienemmän arvon kuin Multiple
#R-squared sillä siinä huomioidaan mallin monimutkaisuus
#eli muuttujien määrä. Adjusted R-squared on tarkempi mallin #suorituskyvyn mittari kuin Multiple R-squared. Uuden
#selittävän muuttujan lisääminen malliin kasvattaa
#todennäköisesti Multiple R-squaredia ja pienentää
#Adjusted R-squaredia.
par(mfrow = c(2,2))
plot(malli2, which = c(1,2,5))
#On piirretty kolme kuvaa, kuva jossa on mallin kaksi sovite ja #residuaalit, QQ-plot-kuva jossa on teoreettiset kvantiilit ja
#standardoidut residuaalit ja kuva jossa on vipuvoima ja
#standardoidut residuaalit.
#Ensimmäisestä kuvasta eli
#kuvasta jossa on sovite x-akselilla ja residuaalit
#y-akselilla voidaan tutkia sitä onko virheillä vakio varianssi.
#Koska havainnot ovat jakautuneet suhteellisen tasaisesti
#nollasuoran ympärille eivätkä muodosta jotakin muotoa
#tai mallia, voidaan sanoa että virhetermin
#varianssi on vakio eikä virheiden suuruus riipu selittävistä
#muuttujista. Virheiden vakio varianssi on yksi oletus
#joka usein tehdään kun estimoidaan lineaarinen regressiomalli.
#Se näyttäisi mallin kaksi tapauksessa olevan voimassa.
#QQ-plot-kuvasta eli kuvasta jossa on teoreettiset kvantiilit
#x-akselilla ja standardoidut residuaalit y-akselilla voidaan
#tehdä päätelmiä virheiden normaalisuudesta. Koska havainnot
#ovat QQ-plot-kuvassa suoran päällä, virhetermin voidaan
#sanoa noudattavan suurin piirtein normaalijakaumaa. Niin
#usein halutaan olettaa ja nyt mallin kaksi tapauksessa voidaan #sanoa että oletus että virheet ovat normaalisti jakaantuneet #voidaan pitää voimassa.
#Kolmannesta kuvasta, jossa on vipuvoima eli Cookin etäisyys #x-akselilla ja standardoidut residuaalit y-akselilla voidaan #päätellä vipuvoiman suuruus. Vipuvoima mittaa sitä kuinka paljon yhdellä havainnolla on vaikutusta malliin. Hajontakuva jossa on #residuaalit ja vipuvoima voi auttaa tunnistamaan ne havainnot #joilla on poikkeuksellisen paljon vaikutusta malliin. Kuvasta
#nähdään että havainto joka saa suurimman vipuvoiman tai Cookin
#etäisyyden arvon saa suunnilleen arvon 0.05. Luku on sen verran
#pieni että vipuvoiman mallissa kaksi voidaan sanoa olevan
#tavallista tai pientä.
math=read.table("data/student-mat.csv", sep = ",", header = TRUE)
por=read.table("data/student-por.csv", sep = ",", header = TRUE)
math=read.table("data/student/student-mat.csv", sep = ",", header = TRUE)
por=read.table("data/student/student-por.csv", sep = ",", header = TRUE)
str(math)
dim(math)
str(por)
dim(por)
math=read.table("data/student/student-mat.csv", sep = ";", header = TRUE)
por=read.table("data/student/student-por.csv", sep = ";", header = TRUE)
str(math)
dim(math)
str(por)
dim(por)
library(dplyr)
# common columns to use as identifiers
join_by = c("school","sex","age","address","famsize","Pstatus",
"Medu","Fedu","Mjob","Fjob","reason","nursery","internet")
# join the two datasets by the selected identifiers
math_por = inner_join(math, por, by = join_by, suffix=c(".math",
".por"))
str(math_por)
dim(math_por)
#Tulostetaan sarakkeiden nimet.
colnames(math_por)
#Luodaan aineisto jossa on vain aiemmin yhdistetyt sarakkeet.
alc <- select(math_por, one_of(join_by))
#sarakkeet joita ei käytetty aineistojen yhdistämiseen
notjoined_columns = colnames(math)[!colnames(math) %in% join_by]
#sarakkeet joita ei käytetty aineistojen yhdistämiseen
#tulostettu
notjoined_columns
#Jokaisen sarakkeen jota ei käytetty aineistojen yhdistämisessä
#nimelle
for(column_name in notjoined_columns) {
#valitaan math_por-aineistosta kaksi saraketta joilla on sama
#alkuperäinen nimi.
two_columns = select(math_por, starts_with(column_name))
#Valitaan sarakkeista ensimmäinen sarakevektori.
first_column = select(two_columns, 1)[[1]]
#Jos ensimmäinen sarake on numeerinen
if(is.numeric(first_column)) {
#otetaan jokaisesta kahden sarakkeen rivistä pyöristetty
#keskiarvo ja lisätään näin saatu vektori alc-aineistoon.
alc[column_name] <- round(rowMeans(two_columns))
} else { # else Jos ensimmäinen sarake ei ole numeerinen
#lisätään ensimmäinen sarakevektori alc-aineistoon.
alc[column_name] <- first_column
}
}
#Määritellään uusi sarake yhdistämällä viikonpäivien ja
#viikonlopun alkoholinkäyttö.
alc = mutate(alc, alc_use = (Dalc + Walc) / 2)
#Määritellään uusi looginen sarake "high_use".
alc = mutate(alc, high_use = alc_use > 2)
glimpse(alc)
write.table(alc, file="data/alc.txt", sep=",")
alc=read.table("data/alc.txt", sep = ",", header = TRUE)
head(alc)
corr(health,high_use)
correlate(health,high_use)
table(health,high_use)
attach(alc)
table(health,high_use)
table(absences,high_use)
table(studytime,high_use)
table(sex,high_use)
barplot(health,high_use)
barplot(absences,high_use)
barplot(studytime,high_use)
barplot(sex,high_use)
boxplot(health,high_use)
boxplot(absences,high_use)
boxplot(studytime,high_use)
boxplot(sex,high_use)
```{r}
table(health,high_use)
table(absences,high_use)
table(studytime,high_use)
table(sex,high_use)
barplot(health,high_use)
barplot(absences,high_use)
barplot(studytime,high_use)
barplot(sex,high_use)
boxplot(health,high_use)
boxplot(absences,high_use)
boxplot(studytime,high_use)
boxplot(sex,high_use)
```
```{r}
table(health,high_use)
table(absences,high_use)
table(studytime,high_use)
table(sex,high_use)
barplot(health,high_use, xlab="1=suuri alkoholinkäyttö on
epätosi, 2=suuri alkoholinkäyttö on tosi", ylab="terveys")
barplot(absences,high_use, xlab="1=suuri alkoholinkäyttö on
epätosi, 2=suuri alkoholinkäyttö on tosi", ylab="poissaolot")
barplot(studytime,high_use, xlab="1=suuri alkoholinkäyttö on
epätosi, 2=suuri alkoholinkäyttö on tosi", ylab="opiskeluun
käytetty aika")
barplot(sex,high_use, xlab="1=suuri alkoholinkäyttö on
epätosi, 2=suuri alkoholinkäyttö on tosi", ylab="sukupuoli")
boxplot(health,high_use, xlab="1=suuri alkoholinkäyttö on
epätosi, 2=suuri alkoholinkäyttö on tosi",ylab="terveys")
boxplot(absences,high_use)
boxplot(studytime,high_use)
boxplot(sex,high_use)
```
```{r}
```{r}
```{r}
```{r}
```{r}
table(health,high_use)
table(absences,high_use)
barplot(health,high_use)
```{r}
m = glm(high_use ~ health + absences + studytime + sex, data = alc, family = "binomial")
summary(m)
coef(m)
```{r}
OR =coef(m) %>% exp
CI=exp(confint(m))
cbind(OR, CI)
```{r}
#Lasketaan malli ilman terveysmuuttujaa jonka kertoimen estimaatti ei ollut tilastollisesti merkitsevä.
m = glm(high_use ~ absences + studytime + sex, data = alc, family =
"binomial")
#Ennustetaan suuren alkoholinkäytön todennäköisyys.
probabilities = predict(m, type = "response")
#Lisätään ennustetut todennäköisyydet aineistoon.
alc = mutate(alc, probability = probabilities)
#Käytetään todennäköisyyksiä suuren alkoholinkäytön ennustamiseen,
alc = mutate(alc, prediction = probabilities>0.5)
#Ristiintaulukoidaan korkea alkoholinkäyttö-muuttuja ennusteiden muuttujasta kanssa.
table(high_use = alc$high_use, prediction = probabilities>0.5)
# Haetaan paketit dplyr ja ggplot2.
library(dplyr); library(ggplot2)
# Piirretään hajontakuva korkeasta alkoholin käytöstä ja sen ennustetuista todennäköisyyksistä.
g = ggplot(alc, aes(x = probability, y = high_use, col=prediction))
# Määritellään geom pisteinä ja piirretään uusi kuva.
g+geom_point()
#Taulukoidaan suuri alkoholinkäyttö ja ennusteet siitä.
table(high_use = alc$high_use, prediction = alc$prediction)%>%prop.table()%>%addmargins()
# Määritellään loss function eli keskimääräinen ennustevirhe.
loss_func = function(class, prob) {
n_wrong = abs(class - prob) > 0.5
mean(n_wrong)
}
# Kutsutaan loss funktio jotta voidaan laskea väärien ennusteiden keskimääräinen määrä aineistossa.
loss_func(class = alc$high_use, prob = alc$probability)
```{r}
